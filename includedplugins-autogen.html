

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SpamAssassin &mdash; fuglu  documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="top" title="fuglu  documentation" href="index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">fuglu  documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="spamassassin">
<h1>SpamAssassin<a class="headerlink" href="#spamassassin" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.sa.SAPlugin</p>
<p>This plugin passes suspects to a spamassassin daemon.</p>
<p>Prerequisites: SPAMD must be installed and running (not necessarily on the same box as fuglu)</p>
<p>Notes for developers:</p>
<p>If you have forwardoriginal=False set the message source will be completely replaced with the answer from spamd.</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>reads <code class="docutils literal"><span class="pre">SAPlugin.skip</span></code>, (boolean) skips scanning if this is True</li>
<li>reads <code class="docutils literal"><span class="pre">SAPlugin.tempheader</span></code>, (text) prepends this text to the scanned message (use this to pass temporary headers to spamassassin which should not be visible in the final message)</li>
<li>sets <code class="docutils literal"><span class="pre">spam['spamassassin']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">SAPlugin.spamscore</span></code> (float) if possible</li>
<li>sets <code class="docutils literal"><span class="pre">SAPlugin.skipreason</span></code> (string) if the message was not scanned (fuglu &gt;0.5.0)</li>
</ul>
</div></blockquote>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[SAPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#reject message template if running in pre-queue mode
rejectmessage=message identified as spam

#forward the original message or replace the content as returned by spamassassin
#if this is set to True/1/Yes , no spamassassin headers will be visible in the final message.
#&quot;original&quot; in this case means &quot;as passed to spamassassin&quot;, eg. if &#39;scanoriginal&#39; is set to 0 above this will forward the
#message as retreived from previous plugins
forwardoriginal=0

#consult spamassassins(or any other) sql blacklist for messages that are too big for spam checks
#requires the sql extension to be enabled
check_sql_blacklist=0

#sqlalchemy db connect string
sql_blacklist_dbconnectstring=mysql:///localhost/spamassassin

#SQL query to get the blacklist entries for a suspect
#you may use template variables: ${from_address} ${from_domain} ${to_address} ${to_domain}
sql_blacklist_sql=SELECT value FROM userpref WHERE prefid=&#39;blacklist_from&#39; AND username in (&#39;$GLOBAL&#39;,concat(&#39;%&#39;,${to_domain}),${to_address})

#maximum size in bytes. larger messages will be skipped
maxsize=256000

#what header does SA set to indicate the spam status
#Note that fuglu requires a standard header template configuration for spamstatus and score extraction
#if &#39;forwardoriginal&#39; is set to 0
#eg. start with _YESNO_ or _YESNOCAPS_ and contain score=_SCORE_
spamheader=X-Spam-Status

#hostname where spamd runs
host=localhost

#what should we do with high spam (spam score above highspamlevel)
highspamaction=DEFAULTHIGHSPAMACTION

#how long should we wait for an answer from sa
timeout=30

#spamscore threshold to mark a message as high spam
highspamlevel=15

#enable SA user configuration
peruserconfig=1

#tcp port number or path to spamd unix socket
port=783

#should we scan the original message as retreived from postfix or scan the current state
#in fuglu (which might have been altered by previous plugins)
#only set this to disabled if you have a custom plugin that adds special headers to the message that will be
#used in spamassassin rules
scanoriginal=1

#what should we do with low spam (eg. detected as spam, but score not over highspamlevel)
lowspamaction=DEFAULTLOWSPAMACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="clam-av">
<h1>Clam AV<a class="headerlink" href="#clam-av" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.clamav.ClamavPlugin</p>
<p>This plugin passes suspects to a clam daemon.</p>
<p>Actions: This plugin will delete infected messages. If clamd is not reachable or times out, messages can be DEFERRED.</p>
<p>Prerequisites: You must have clamd installed (for performance reasons I recommend it to be on the same box, but this is not absoluely necessary)</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['ClamAV']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">ClamavPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id1">
<h2>Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[ClamavPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where clamd runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#socket timeout
timeout=30

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

pipelining=0

#maximum message size, larger messages will not be scanned.
#should match the &#39;StreamMaxLength&#39; config option in clamd.conf
maxsize=22000000

#tcp port number or path to clamd.sock for unix domain sockets
#example /var/lib/clamav/clamd.sock or on ubuntu: /var/run/clamav/clamd.ctl
port=3310

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="attachment-blocker">
<h1>Attachment Blocker<a class="headerlink" href="#attachment-blocker" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.attachment.FiletypePlugin</p>
<p>This plugin checks message attachments. You can configure what filetypes or filenames are allowed to pass through fuglu. If a attachment is not allowed, the message is deleted and the sender receives a bounce error message. The plugin uses the &#8216;&#8217;&#8216;file&#8217;&#8216;&#8217; library to identify attachments, so even if a smart sender renames his executable to .txt, fuglu will detect it.</p>
<p>Attachment rules can be defined globally, per domain or per user.</p>
<p>Actions: This plugin will delete messages if they contain blocked attachments.</p>
<p>Prerequisites: You must have the python <code class="docutils literal"><span class="pre">file</span></code> or <code class="docutils literal"><span class="pre">magic</span></code> module installed. Additionaly, for scanning filenames within rar archives, fuglu needs the python <code class="docutils literal"><span class="pre">rarfile</span></code> module.</p>
<p>The attachment configuration files are in <code class="docutils literal"><span class="pre">/etc/fuglu/rules</span></code>. You should have two default files there: <code class="docutils literal"><span class="pre">default-filenames.conf</span></code> which defines what filenames are allowed and <code class="docutils literal"><span class="pre">default-filetypes.conf</span></code> which defines what content types a attachment may have.</p>
<p>For domain rules, create a new file <code class="docutils literal"><span class="pre">&lt;domainname&gt;-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">&lt;domainname&gt;-filetypes.conf</span></code> , eg. <code class="docutils literal"><span class="pre">fuglu.org-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">fuglu.org-filetypes.conf</span></code></p>
<p>For individual user rules, create a new file <code class="docutils literal"><span class="pre">&lt;useremail&gt;-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">&lt;useremail&gt;-filetypes.conf</span></code>, eg. <code class="docutils literal"><span class="pre">oli&#64;fuglu.org-filenames.conf</span></code> / <code class="docutils literal"><span class="pre">oli&#64;fuglu.org-filetypes.conf</span></code></p>
<p>To scan filenames or even file contents within archives (zip, rar), use <code class="docutils literal"><span class="pre">&lt;...&gt;-archivefilenames.conf</span></code> and <code class="docutils literal"><span class="pre">&lt;...&gt;-archivefiletypes.conf</span></code>.</p>
<p>The format of those files is as follows: Each line should have three parts, seperated by tabs (or any whitespace):
<code class="docutils literal"><span class="pre">&lt;action&gt;</span></code>    <code class="docutils literal"><span class="pre">&lt;regular</span> <span class="pre">expression&gt;</span></code>   <code class="docutils literal"><span class="pre">&lt;description</span> <span class="pre">or</span> <span class="pre">error</span> <span class="pre">message&gt;</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;action&gt;</span></code> can be one of:</dt>
<dd><ul class="first last simple">
<li>allow : this file is ok, don&#8217;t do further checks (you might use it for safe content types like text). Do not blindly create &#8216;allow&#8217; rules. It&#8217;s safer to make no rule at all, if no other rules hit, the file will be accepted</li>
<li>deny : delete this message and send the error message/description back to the sender</li>
<li>delete : silently delete the message, no error is sent back, and &#8216;blockaction&#8217; is ignored</li>
</ul>
</dd>
</dl>
<p><code class="docutils literal"><span class="pre">&lt;regular</span> <span class="pre">expression&gt;</span></code> is a standard python regex. in <code class="docutils literal"><span class="pre">x-filenames.conf</span></code> this will be applied to the attachment name . in <code class="docutils literal"><span class="pre">x-filetypes.conf</span></code> this will be applied to the mime type of the file as well as the file type returned by the <code class="docutils literal"><span class="pre">file</span></code> command.</p>
<p>Example of <code class="docutils literal"><span class="pre">default-filetypes.conf</span></code> :</p>
<div class="highlight-python"><div class="highlight"><pre>allow    text        -
allow    script    -
allow    archive        -
allow    postscript    -
deny    self-extract    No self-extracting archives
deny    executable    No programs allowed
deny    ELF        No programs allowed
deny    Registry    No Windows Registry files allowed
</pre></div>
</div>
<p>A small extract from <code class="docutils literal"><span class="pre">default-filenames.conf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>deny    \.ico$            Windows icon file security vulnerability
deny    \.ani$            Windows animated cursor file security vulnerability
deny    \.cur$            Windows cursor file security vulnerability
deny    \.hlp$            Windows help file security vulnerability

allow    \.jpg$            -
allow    \.gif$            -
</pre></div>
</div>
<p>Note: The files will be reloaded automatically after a few seconds (you do not need to kill -HUP / restart fuglu)</p>
<p>Per domain/user overrides can also be fetched from a database instead of files (see dbconnectstring / query options).
The query must return the same rule format as a file would. Multiple columns in the resultset will be concatenated.</p>
<p>The default query assumes the following schema:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE `attachmentrules` (
  `rule_id` int(11) NOT NULL AUTO_INCREMENT,
  `action` varchar(10) NOT NULL,
  `regex` varchar(255) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `scope` varchar(255) DEFAULT NULL,
  `checktype` varchar(20) NOT NULL,
  `prio` int(11) NOT NULL,
  PRIMARY KEY (`rule_id`)
)
</pre></div>
</div>
<p><em>action</em>: <code class="docutils literal"><span class="pre">allow</span></code>, <code class="docutils literal"><span class="pre">deny</span></code>, or <code class="docutils literal"><span class="pre">delete</span></code></p>
<p><em>regex</em>: a regular expression</p>
<p><em>description</em>: description/explanation of this rule which is optionally sent back to the sender if bounces are enabled</p>
<p><em>scope</em>: a domain name or a recipient&#8217;s email address</p>
<p><em>checktype</em>: one of <code class="docutils literal"><span class="pre">filename</span></code>,``contenttype``,``archive-filename``,``archive-contenttype``</p>
<p><em>prio</em>: order in which the rules are run</p>
<p>The bounce template (eg <code class="docutils literal"><span class="pre">/etc/fuglu/templates/blockedfile.tmpl</span></code> ) should
start by defining the headers, followed by a blank line, then the message body for your bounce message. Something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>To: ${from_address}
Subject: Blocked attachment

Your message to ${to_address} contains a blocked attachment and has not been delivered.

${blockinfo}
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">${blockinfo}</span></code> will be replaced with the text you specified in the third column of the rule that blocked this message.</p>
<p>The other common template variables are available as well.</p>
<div class="section" id="id2">
<h2>Configuration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[FiletypePlugin]
#inform the sender about blocked attachments.
#If a previous plugin tagged the message as spam or infected, no bounce will be sent to prevent backscatter
sendbounce=1

#sqlalchemy connectstring to load rules from a database and use files only as fallback. requires SQL extension to be enabled
dbconnectstring=

#sql query to load rules from a db. #:scope will be replaced by the recipient address first, then by the recipient domain
#:check will be replaced &#39;filename&#39;,&#39;contenttype&#39;,&#39;archive-filename&#39; or &#39;archive-contenttype&#39;
query=SELECT action,regex,description FROM attachmentrules WHERE scope=:scope AND checktype=:checktype ORDER BY prio

#Mail template for the bounce to inform sender about blocked attachment
template_blockedfile=/etc/fuglu/templates/blockedfile.tmpl

#directory that contains attachment rules
rulesdir=/etc/fuglu/rules

#enable scanning of filenames within archives (zip,rar). This does not actually extract the files, it just looks at the filenames found in the archive.
checkarchivenames=0

#what should the plugin do when a blocked attachment is detected
#REJECT : reject the message (recommended in pre-queue mode)
#DELETE : discard messages
#DUNNO  : mark as blocked but continue anyway (eg. if you have a later quarantine plugin)
blockaction=DELETE

#extract compressed archives(zip,rar) and check file content type with libmagics
#note that the files will be extracted into memory - tune archivecontentmaxsize  accordingly.
#fuglu does not extract archives within the archive(recursion)
checkarchivecontent=0

#only extract and examine files up to this amount of (uncompressed) bytes
archivecontentmaxsize=5000000
</pre></div>
</div>
</div>
</div>
<div class="section" id="archive">
<h1>Archive<a class="headerlink" href="#archive" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.archive.ArchivePlugin</p>
<p>This plugins stores a copy of the message if it matches certain criteria (Suspect Filter).
You can use this if you want message archives for your domains or to debug problems occuring only for certain recipients.</p>
<p>Examples for the archive.regex filter file:</p>
<p>Archive messages to domain &#8216;&#8217;test.com&#8217;&#8216;:</p>
<p><code class="docutils literal"><span class="pre">to_domain</span> <span class="pre">test\.com</span></code></p>
<p>Archive messages from <a class="reference external" href="mailto:oli&#37;&#52;&#48;fuglu&#46;org">oli<span>&#64;</span>fuglu<span>&#46;</span>org</a>:</p>
<p><code class="docutils literal"><span class="pre">envelope_from</span> <span class="pre">oli&#64;fuglu\.org</span></code></p>
<p>you can also append &#8220;yes&#8221; and &#8220;no&#8221; to the rules to create a more advanced configuration. Lets say we want to archive all messages to <a class="reference external" href="mailto:sales&#37;&#52;&#48;fuglu&#46;org">sales<span>&#64;</span>fuglu<span>&#46;</span>org</a> and all regular messages <a class="reference external" href="mailto:support&#37;&#52;&#48;fuglu&#46;org">support<span>&#64;</span>fuglu<span>&#46;</span>org</a> except the ones created by automated scripts like logwatch or daily backup messages etc.</p>
<p>envelope_from logwatch&#64;.*fuglu.org   no</p>
<p>envelope_to <a class="reference external" href="mailto:sales&#37;&#52;&#48;fuglu&#46;org">sales<span>&#64;</span>fuglu<span>&#46;</span>org</a> yes</p>
<p>from <a class="reference external" href="mailto:backups&#37;&#52;&#48;fuglu&#46;org">backups<span>&#64;</span>fuglu<span>&#46;</span>org</a> no</p>
<p>envelope_to <a class="reference external" href="mailto:support&#37;&#52;&#48;fuglu&#46;org">support<span>&#64;</span>fuglu<span>&#46;</span>org</a>      yes</p>
<p>Note: The first rule to match in a message is the only rule that will be applied. Exclusion rules should therefore be put above generic/catch-all rules.</p>
<div class="section" id="id3">
<h2>Configuration<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[ArchivePlugin]
#change owner of saved messages (username or numeric id) - this only works if fuglu is running as root (which is NOT recommended)
chown=

#Archiving SuspectFilter File
archiverules=/etc/fuglu/archive.regex

#filename template for the archived messages
filenametemplate=${id}.eml

#subdirectory within archivedir
subdirtemplate=${to_domain}

#if true/1/yes: store original message
#if false/0/no: store message probably altered by previous plugins, eg with spamassassin headers
storeoriginal=1

#storage for archived messages
archivedir=/tmp

#set file permissions of saved messages
chmod=

#change group of saved messages (groupname or numeric id) - the user running fuglu must be a member of the target group for this to work
chgrp=
</pre></div>
</div>
</div>
</div>
<div class="section" id="vacation">
<h1>Vacation<a class="headerlink" href="#vacation" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.vacation.VacationPlugin</p>
<p>Sends out-of-office reply messages. Configuration is trough a sql database. Replies are only sent once per day per sender. The plugin will not reply to any &#8216;automated&#8217; messages (Mailingslists, Spams, Bounces etc)</p>
<p>Requires: SQLAlechemy Extension</p>
<dl class="docutils">
<dt>Required DB Tables:</dt>
<dd><ul class="first last simple">
<li>vacation (fuglu reads this table only, must be filled from elsewhere)<ul>
<li>id int : id of this vacation</li>
<li>created timestamp :  creation timestamp</li>
<li>enabled boolean (eg. tinyint) : if disabled, no vacation reply will be sent</li>
<li>start timestamp: replies will only be sent after this point in time</li>
<li>end timestamp: replies will only be sent before this point in time</li>
<li>awayuser varchar: the email address of the user that is on vacation</li>
<li>subject: subject of the vacation message</li>
<li>body : body of the vacation message</li>
<li>ignoresender: whitespace delimited list of domains or email addresses that should not receive vacation replies</li>
</ul>
</li>
<li>vacationreply (this table is filled by fuglu)<ul>
<li>id int: id of the reply</li>
<li>vacation_id : id of the vacation</li>
<li>sent timestamp: timestamp when the reply was sent</li>
<li>recipient: recipient to whom the reply was sent</li>
</ul>
</li>
</ul>
</dd>
</dl>
<p>SQL Example for mysql:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE `vacation` (
  `id` int(11) NOT NULL auto_increment,
  `created` timestamp NOT NULL default now(),
  `start` timestamp NOT NULL,
  `end` timestamp NOT NULL ,
  `enabled` tinyint(1) NOT NULL default 1,
  `awayuser` varchar(255) NOT NULL,
  `subject` varchar(255) NOT NULL,
  `body` text NOT NULL,
  `ignoresender` text NOT NULL,
  PRIMARY KEY  (`id`),
  UNIQUE(`awayuser`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ;


CREATE  TABLE `vacationreply` (
  `id` int(11) NOT NULL auto_increment,
  `recipient` varchar(255) NOT NULL,
  `vacation_id` int(11) NOT NULL,
     `sent` timestamp not null default now(),
  PRIMARY KEY  (`id`),
  KEY `vacation_id` (`vacation_id`),
  CONSTRAINT `vacation_ibfk_1` FOREIGN KEY (`vacation_id`) REFERENCES `vacation` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</pre></div>
</div>
<div class="section" id="id4">
<h2>Configuration<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[VacationPlugin]
#sqlalchemy connectstring to load vacations
dbconnectstring=
</pre></div>
</div>
</div>
</div>
<div class="section" id="sophos">
<h1>Sophos<a class="headerlink" href="#sophos" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.sssp.SSSPPlugin</p>
<blockquote>
<div>This plugin scans the suspect using the sophos SSSP protocol.</div></blockquote>
<p>Prerequisites: Requires a running sophos daemon with dynamic interface (SAVDI)</p>
<div class="section" id="id5">
<h2>Configuration<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[SSSPPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where the SSSP server runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#socket timeout
timeout=30

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#maximum message size, larger messages will not be scanned.
maxsize=22000000

#tcp port or path to unix socket
port=4010

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="f-prot-av">
<h1>F-Prot AV<a class="headerlink" href="#f-prot-av" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.fprot.FprotPlugin</p>
<blockquote>
<div>This plugin passes suspects to a f-prot scan daemon</div></blockquote>
<p>Prerequisites: f-protd must be installed and running, not necessarily on the same box as fuglu though.</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['F-Prot']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">FprotPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id6">
<h2>Configuration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[FprotPlugin]
#additional scan options  (see `man fpscand` -&gt; SCANNING OPTIONS for possible values)
scanoptions=

#maximum retries on failed connections
retries=3

#hostname where fpscand runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#if fpscand runs on a different host than fuglu, set this to 1 to send the message over the network instead of just the filename
networkmode=0

#network timeout
timeout=30

#plugin action if scan fails
problemaction=DEFER

#maximum message size to scan
maxsize=10485000

#fpscand port
port=10200

#plugin action if threat is detected
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="icap-av">
<h1>ICAP AV<a class="headerlink" href="#icap-av" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.icap.ICAPPlugin</p>
<p>ICAP Antivirus Plugin
This plugin allows Antivirus Scanning over the ICAP Protocol (<a class="reference external" href="http://tools.ietf.org/html/rfc3507">http://tools.ietf.org/html/rfc3507</a> )
supported by some AV Scanners like Symantec and Sophos. For sophos, however, it is recommended to use the native SSSP Protocol.</p>
<p>Prerequisites: requires an ICAP capable antivirus engine somewhere in your network</p>
<div class="section" id="id7">
<h2>Configuration<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[ICAPPlugin]
#how often should fuglu retry the connection before giving up
retries=3

#hostname where the ICAP server runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#ICAP Av scan service, usually AVSCAN (sophos, symantec)
service=AVSCAN

#socket timeout
timeout=10

#action if there is a problem (DUNNO, DEFER)
problemaction=DEFER

#name of the virus engine behind the icap service. used to inform other plugins. can be anything like &#39;sophos&#39;, &#39;symantec&#39;, ...
enginename=icap-generic

#maximum message size, larger messages will not be scanned.
maxsize=22000000

#tcp port or path to unix socket
port=1344

#action if infection is detected (DUNNO, REJECT, DELETE)
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="drweb-av">
<h1>DrWeb AV<a class="headerlink" href="#drweb-av" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.drweb.DrWebPlugin</p>
<blockquote>
<div>This plugin passes suspects to a DrWeb scan daemon</div></blockquote>
<p>EXPERIMENTAL Plugin: has not been tested in production.</p>
<p>Prerequisites: Dr.Web unix version must be installed and running, not necessarily on the same box as fuglu though.</p>
<p>Notes for developers:</p>
<p>Tags:</p>
<blockquote>
<div><ul class="simple">
<li>sets <code class="docutils literal"><span class="pre">virus['drweb']</span></code> (boolean)</li>
<li>sets <code class="docutils literal"><span class="pre">DrWebPlugin.virus</span></code> (list of strings) - virus names found in message</li>
</ul>
</div></blockquote>
<div class="section" id="id8">
<h2>Configuration<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[DrWebPlugin]
#maximum retries on failed connections
retries=3

#hostname where fpscand runs
host=localhost

#reject message template if running in pre-queue mode and virusaction=REJECT
rejectmessage=threat detected: ${virusname}

#network timeout
timeout=30

#plugin action if scan fails
problemaction=DEFER

#maximum message size to scan
maxsize=22000000

#DrWeb daemon port
port=3000

#plugin action if threat is detected
virusaction=DEFAULTVIRUSACTION
</pre></div>
</div>
</div>
</div>
<div class="section" id="action-override">
<h1>Action Override<a class="headerlink" href="#action-override" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.actionoverride.ActionOverridePlugin</p>
<blockquote>
<div>Averride actions based on a Suspect Filter file. For example, delete all messages from a specific sender domain.</div></blockquote>
<div class="section" id="id9">
<h2>Configuration<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[ActionOverridePlugin]
#Rules file
actionrules=/etc/fuglu/actionrules.regex
</pre></div>
</div>
</div>
</div>
<div class="section" id="scriptfilter">
<h1>ScriptFilter<a class="headerlink" href="#scriptfilter" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.script.ScriptFilter</p>
<p>This plugin executes scripts found in a specified directory.
This can be used to quickly add a custom filter script without changing the fuglu configuration.</p>
<p>Filterscripts must be written in standard python but with the file ending <code class="docutils literal"><span class="pre">.fgf</span></code> (&#8220;fuglu filter&#8221;)</p>
<p>Scripts are reloaded for every message and executed in alphabetic order. You do not need to restart fuglu to load any changes made to these files.</p>
<p>The API is basically the same as for normal plugins within the <code class="docutils literal"><span class="pre">examine()</span></code> method, with a few special cases:</p>
<p>there is no &#8216;self&#8217; which means:</p>
<blockquote>
<div><ul class="simple">
<li>access the configuration by using <code class="docutils literal"><span class="pre">config</span></code> directly (instead of <code class="docutils literal"><span class="pre">self.config</span></code>)</li>
<li>use <code class="docutils literal"><span class="pre">debug('hello</span> <span class="pre">world')</span></code> instead of <code class="docutils literal"><span class="pre">self._logger().debug('hello</span> <span class="pre">world')</span></code>, this will also automatically write to the message debug channel</li>
</ul>
</div></blockquote>
<p>the script should not return anything, but change the available variables <code class="docutils literal"><span class="pre">action</span></code> and <code class="docutils literal"><span class="pre">message</span></code> instead
(<code class="docutils literal"><span class="pre">DUNNO</span></code>, <code class="docutils literal"><span class="pre">REJECT</span></code>, <code class="docutils literal"><span class="pre">DEFER</span></code>, <code class="docutils literal"><span class="pre">ACCEPT</span></code>, <code class="docutils literal"><span class="pre">DELETE</span></code> are already imported)</p>
<p>use <code class="docutils literal"><span class="pre">stop()</span></code> to exit the script</p>
<p>Example script:
(put this in /etc/fuglu/scriptfilter/99_demo.fgf for example)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#block all messages from evilsender.example.com</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">suspect</span><span class="o">.</span><span class="n">from_domain</span><span class="o">==</span><span class="s">&#39;evilsender.example.com&#39;</span><span class="p">:</span>
    <span class="n">suspect</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&quot;x-fuglu-SenderDomain&quot;</span><span class="p">,</span><span class="n">suspect</span><span class="o">.</span><span class="n">from_domain</span><span class="p">,</span><span class="n">immediate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">stop</span><span class="p">()</span>
<span class="n">debug</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">)</span>
<span class="n">action</span><span class="o">=</span><span class="n">REJECT</span>
<span class="n">message</span><span class="o">=</span><span class="s">&quot;you shall not pass&quot;</span>
</pre></div>
</div>
<div class="section" id="id10">
<h2>Configuration<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[ScriptFilter]
#Dir that contains the scripts (*.fgf files)
scriptdir=/etc/fuglu/scriptfilter
</pre></div>
</div>
</div>
</div>
<div class="section" id="dkim-sign">
<h1>DKIM Sign<a class="headerlink" href="#dkim-sign" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.domainauth.DKIMSignPlugin</p>
<p><strong>EXPERIMENTAL</strong>
Add DKIM Signature to outgoing mails</p>
<p>Setting up your keys:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir -p /etc/fuglu/dkim
domain=example.com
openssl genrsa -out /etc/fuglu/dkim/${domain}.key 1024
openssl rsa -in /etc/fuglu/dkim/${domain}.key -out /etc/fuglu/dkim/${domain}.pub -pubout -outform PEM
# print out the DNS record:
echo -n &quot;default._domainkey TXT  \&quot;v=DKIM1; k=rsa; p=&quot; ; cat /etc/fuglu/dkim/${domain}.pub | grep -v &#39;PUBLIC KEY&#39; | tr -d &#39;\n&#39; ; echo &quot;;\&quot;&quot;
</pre></div>
</div>
<p>If fuglu handles both incoming and outgoing mails you should make sure that this plugin is skipped for incoming mails</p>
<div class="section" id="id11">
<h2>Configuration<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[DKIMSignPlugin]
#comma separated list of headers to sign. empty string=sign all headers
signheaders=

#include l= tag in dkim header
signbodylength=False

#selector to use when signing, supports templates
selector=default

#Location of the private key file. supports standard template variables plus additional ${header_from_domain} which extracts the domain name from the From: -Header
privatekeyfile=/etc/fuglu/dkim/${header_from_domain}.key

#Type of body canonicalization (simple or relaxed)
canonicalizebody=relaxed

#Type of header canonicalization (simple or relaxed)
canonicalizeheaders=relaxed
</pre></div>
</div>
</div>
</div>
<div class="section" id="dkim-verify">
<h1>DKIM Verify<a class="headerlink" href="#dkim-verify" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.domainauth.DKIMVerifyPlugin</p>
<p><strong>EXPERIMENTAL</strong>
This plugin checks the DKIM signature of the message and sets tags...
DKIMVerify.sigvalid : True if there was a valid DKIM signature, False if there was an invalid DKIM signature
the tag is not set if there was no dkim header at all</p>
<p>DKIMVerify.skipreason: set if the verification has been skipped</p>
<p>The plugin does not take any action based on the DKIM test result since a failed DKIM validation by itself
should not cause a message to be treated any differently. Other plugins might use the DKIM result
in combination with other factors to take action (for example a &#8220;DMARC&#8221; plugin could use this information)</p>
<p>It is currently recommended to leave both header and body canonicalization as &#8216;relaxed&#8217;. Using &#8216;simple&#8217; can cause the signature to fail.</p>
<div class="section" id="id12">
<h2>Configuration<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">DKIMVerifyPlugin</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="spf-check">
<h1>SPF Check<a class="headerlink" href="#spf-check" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.domainauth.SPFPlugin</p>
<p><strong>EXPERIMENTAL</strong>
This plugin checks the SPF status and sets tag &#8216;SPF.status&#8217; to one of the official states &#8216;pass&#8217;, &#8216;fail&#8217;, &#8216;neutral&#8217;,
&#8216;softfail, &#8216;permerror&#8217;, &#8216;temperror&#8217; or &#8216;skipped&#8217; if the SPF check could not be peformed.
Tag &#8216;SPF.explanation&#8217; contains a human readable explanation of the result</p>
<p>The plugin does not take any action based on the SPF test result since. Other plugins might use the SPF result
in combination with other factors to take action (for example a &#8220;DMARC&#8221; plugin could use this information)</p>
<div class="section" id="id13">
<h2>Configuration<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">SPFPlugin</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plugin-skipper">
<h1>Plugin Skipper<a class="headerlink" href="#plugin-skipper" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.p_skipper.PluginSkipper</p>
<p>Skips plugins based on standard filter file
This can be used for example to skip spam filters on outgoing messages.
e.g. put this in /etc/fuglu/skipplugins.regex:</p>
<p>&#64;incomingport    1099    SAPlugin</p>
<div class="section" id="id14">
<h2>Configuration<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[PluginSkipper]
filterfile=/etc/fuglu/skipplugins.regex
</pre></div>
</div>
</div>
</div>
<div class="section" id="plugin-fraction">
<h1>Plugin Fraction<a class="headerlink" href="#plugin-fraction" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.p_fraction.PluginFraction</p>
<p>Runs only a fraction of loaded scanner plugins based on standard filter file
Use this if you only want to run a fraction of the standard plugins on a specific port for example
eg. put this in /etc/fuglu/pluginfraction.regex:</p>
<p>&#64;incomingport    1100    SAPlugin,AttachmentPlugin</p>
<div class="section" id="id15">
<h2>Configuration<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[PluginFraction]
filterfile=/etc/fuglu/pluginfraction.regex
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugger">
<h1>Debugger<a class="headerlink" href="#debugger" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.p_debug.MessageDebugger</p>
<p>Message Debugger Plugin (Prepender).</p>
<p>This plugin enables the fuglu_debug functionality. Make sure fuglu listens on the debug port configured here.</p>
<div class="section" id="id16">
<h2>Configuration<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[MessageDebugger]
#messages incoming on this port will be debugged to a logfile
#Make sure the debugport is also set in the incomingport configuration option in the main section
debugport=10888

#debug log output
debugfile=/tmp/fuglu_debug.log

#don&#39;t re-inject debugged messages back to postfix
noreinject=1

#debugged message can not be bounced
nobounce=1

#don&#39;t run appender plugins for debugged messages
noappender=1
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-plugin-time">
<h1>Statsd Sender: Plugin Time<a class="headerlink" href="#statsd-sender-plugin-time" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.a_statsd.PluginTime</p>
<p>EXPERIMENTAL: Send Plugin execution time to a statsd server</p>
<div class="section" id="id17">
<h2>Configuration<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[PluginTime]
#statsd host
host=127.0.0.1

#statsd port
port=8125
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-global-message-status">
<h1>Statsd Sender: Global Message Status<a class="headerlink" href="#statsd-sender-global-message-status" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.a_statsd.MessageStatus</p>
<p>EXPERIMENTAL: Send message status to a statsd server</p>
<div class="section" id="id18">
<h2>Configuration<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[MessageStatus]
#statsd host
host=127.0.0.1

#statsd port
port=8125
</pre></div>
</div>
</div>
</div>
<div class="section" id="statsd-sender-per-recipient-message-status">
<h1>Statsd Sender: Per Recipient Message Status<a class="headerlink" href="#statsd-sender-per-recipient-message-status" title="Permalink to this headline">¶</a></h1>
<p>Plugin: fuglu.plugins.a_statsd.MessageStatusPerRecipient</p>
<p>EXPERIMENTAL: Send per recipient stats to a statsd server</p>
<div class="section" id="id19">
<h2>Configuration<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>[MessageStatusPerRecipient]
#statsd host
host=127.0.0.1

#statsd port
port=8125

#domain: send stats per recipient domain. email: send stats per recipient email address
level=domain
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinxlocaltoc">
    <h3><a href="index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">SpamAssassin</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#clam-av">Clam AV</a><ul>
<li><a class="reference internal" href="#id1">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attachment-blocker">Attachment Blocker</a><ul>
<li><a class="reference internal" href="#id2">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#archive">Archive</a><ul>
<li><a class="reference internal" href="#id3">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vacation">Vacation</a><ul>
<li><a class="reference internal" href="#id4">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sophos">Sophos</a><ul>
<li><a class="reference internal" href="#id5">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#f-prot-av">F-Prot AV</a><ul>
<li><a class="reference internal" href="#id6">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#icap-av">ICAP AV</a><ul>
<li><a class="reference internal" href="#id7">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#drweb-av">DrWeb AV</a><ul>
<li><a class="reference internal" href="#id8">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#action-override">Action Override</a><ul>
<li><a class="reference internal" href="#id9">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scriptfilter">ScriptFilter</a><ul>
<li><a class="reference internal" href="#id10">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dkim-sign">DKIM Sign</a><ul>
<li><a class="reference internal" href="#id11">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dkim-verify">DKIM Verify</a><ul>
<li><a class="reference internal" href="#id12">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spf-check">SPF Check</a><ul>
<li><a class="reference internal" href="#id13">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-skipper">Plugin Skipper</a><ul>
<li><a class="reference internal" href="#id14">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-fraction">Plugin Fraction</a><ul>
<li><a class="reference internal" href="#id15">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugger">Debugger</a><ul>
<li><a class="reference internal" href="#id16">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-plugin-time">Statsd Sender: Plugin Time</a><ul>
<li><a class="reference internal" href="#id17">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-global-message-status">Statsd Sender: Global Message Status</a><ul>
<li><a class="reference internal" href="#id18">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statsd-sender-per-recipient-message-status">Statsd Sender: Per Recipient Message Status</a><ul>
<li><a class="reference internal" href="#id19">Configuration</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/includedplugins-autogen.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">fuglu  documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, gryphius.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>